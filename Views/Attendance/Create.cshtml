@model List<SchoolSystem.Data.Attendance>

@{
    ViewData["Title"] = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ùˆ Ø§Ù„ØºÙŠØ§Ø¨";
}

<h1>ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ùˆ ØºÙŠØ§Ø¨ Ù„Ù„Ø·Ù„Ø§Ø¨</h1>
<hr />
<form action="Create" method="post">
    @Html.AntiForgeryToken()
    

    <table class="table" id="attendancesTable">
        <thead>
            <tr>
                <th>Ø§Ù„Ø§Ø³Ù… </th>
                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th>Ø§Ù„Ø¹Ø°Ø±</th>
            </tr>
        </thead>
        <tbody>@{
            int IdLectuer = ViewBag.IdLectuer;
            int IdTeacher = ViewBag.IdTeacher;
            int IdClass = ViewBag.IdClass;
            DateOnly DateAndTime = ViewBag.DateAndTime;
            for (int i = 0; i < ViewBag.Students.Count; i++)
            {
                
                var student = ViewBag.Students[i];
                if (student.Id != null)  // ØªØ­Ù‚Ù‚ Ø£ÙˆÙ„Ø§
                {
                <tr>
                    <input type="hidden" name="Attendances[@i].IdLectuer" value="@IdLectuer" />
                    <input type="hidden" name="Attendances[@i].IdTeacher" value="@IdTeacher" />
                    <input type="hidden" name="Attendances[@i].DateAndTime" value="@DateAndTime" />
                    <input type="hidden" name="Attendances[@i].IdClass" value="@IdClass" />
                    <td>
                        @student.IdStudentNavigation.Name
                        <input type="hidden" name="Attendances[@i].IdStudent" value="@student.IdStudent" />
                    </td>
                    <td>
                        <select name="Attendances[@i].AttendanceStatus" class="form-control attendance-status">
                            <option value="1">Ø­Ø¶ÙˆØ±</option>
                            <option value="0">ØºÙŠØ§Ø¨</option>
                            <option value="m">ØºÙŠØ§Ø¨ Ø¨Ø¹Ø°Ø±</option>
                        </select>
                    </td>
                    <td> 
                        <input type="text" name="Attendances[@i].Excuse" class="form-control excuse-input" disabled />
                    </td>
                </tr>
            }}
            }
            
            
        </tbody>
    </table>

    <button type="submit" class="btn btn-success">Ø­ÙØ¸</button>
    <a class="btn btn-dark" asp-action="Index" asp-route-teacherId="@ViewBag.IdTeacher">Ø¹ÙˆØ¯Ø© Ø¯ÙˆÙ† Ø­ÙØ¸</a>
</form>

@section Scripts {
    <script>
        $(function() {
            $('#attendancesTable').DataTable({
            paging: false,
            searching: true,
            info: true,
            lengthChange: false,
            ordering: true,
            language: {
                "search": "ğŸ”Ø¨Ø­Ø«: ",
                "info": "Ø¹Ø±Ø¶ Ù…Ù†  _START_ Ø§Ù„Ù‰ _END_ Ù…Ù† Ø§ØµÙ„ _TOTAL_ Ø³Ø¬Ù„",
                "zeroRecords": "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª"
            },
            dom:
            "<'row mb-3'<'col-sm-12 text-end'f>>" +        // Ø§Ù„Ø¨Ø­Ø« ÙÙ‚Ø· ÙÙŠ Ø§Ù„ÙŠÙ…ÙŠÙ†
            "<'row'<'col-sm-12'tr>>" +                     // Ø§Ù„Ø¬Ø¯ÙˆÙ„
            "<'row mt-3'<'col-sm-6 text-start'i>>" // Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙŠØ³Ø§Ø± ÙˆØ§Ù„ØªØ±Ù‚ÙŠÙ… ÙŠÙ…ÙŠÙ†
        });
        });
    </script>
    <script>
        $(document).ready(function () {
            $('.attendance-status').on('change', function () {
                var selected = $(this).val();
                var excuseInput = $(this).closest('tr').find('.excuse-input');

                if (selected === 'm') {
                    excuseInput.prop('disabled', false);
                } else {
                    excuseInput.prop('disabled', true).val('');
                }
            });
        });
    </script>
}
