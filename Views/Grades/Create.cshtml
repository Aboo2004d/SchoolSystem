@model SchoolSystem.Data.Grade
@using SchoolSystem.Data;
@{
    ViewData["Title"] = "Create";
}

<h4>Ø§Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ù„Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„ØµÙ: @ViewBag.GradeName ÙÙŠ Ù…Ø§Ø¯Ø©: @ViewBag.SubjectName</h4>
<hr />
<table class="table" id="gradesTable">
    <thead>
        <tr style="font-size: smaller;">
            <th >Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
            <th>Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø§ÙˆÙ„</th>
            <th>Ø§Ù„Ù†ØµÙÙŠ</th>
            <th>Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ</th>
            <th>Ø§Ù„Ù†Ø´Ø§Ø·</th>
            <th>Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
        </tr>
    </thead>
    <tbody>
    @for (int i = 0; i < ViewBag.StudentsWithGrades.Count; i++)
    {
        var item = ViewBag.StudentsWithGrades[i];
        var student = item.Student;
        var grade = item.Grade ?? new Grade();

        <tr>
            <td style="font-size: smaller;">
                 @{
                    var fullname = student.Name.Split(' ');
                    int nameLength = fullname.Length;
                    var firstName = fullname[0];
                    var lastName = fullname[nameLength - 1];
                    if(fullname.Length > 1){
                        lastName = fullname[nameLength - 1];
                        <p>@firstName - @lastName</p> 
                    }else{
                        @firstName
                    }
                } 
                <input type="hidden" name="Grades[@i].StudentId" value="@student.Id" />
            </td>
            <td><input type="number" class="form-control small-input" name="Grades[@i].FirstMonth" value="@(grade.FirstMonth )" /></td>
            <td><input type="number" class="form-control small-input" name="Grades[@i].Mid" value="@(grade.Mid )" /></td>
            <td><input type="number" class="form-control small-input" name="Grades[@i].SecondMonth" value="@(grade.SecondMonth )" /></td>
            <td><input type="number" class="form-control small-input" name="Grades[@i].Activity" value="@(grade.Activity)" /></td>
            <td><input type="number" class="form-control small-input" name="Grades[@i].Final" value="@(grade.Final )" /></td>
        </tr>
    }


    </tbody>
</table>


<div>
    <button type="button" class="btn btn-success" id="saveAllBtn">Ø­ÙØ¸</button>
    <a class="btn btn-dark" asp-action="ViewGrades" asp-route-teacherId="@ViewBag.TeacherId">Ø¹ÙˆØ¯Ø© Ø¯ÙˆÙ† Ø­ÙØ¸</a>
</div>

@section Scripts {
    <script>
    $(document).ready(function () {
        $('#gradesTable').DataTable({
            paging: false,
            searching: true,
            info: true,
            lengthChange: false,
            ordering: true,
            language: {
                "search": "ğŸ”Ø¨Ø­Ø«: ",
                "info": "Ø¹Ø±Ø¶ Ù…Ù†  _START_ Ø§Ù„Ù‰ _END_ Ù…Ù† Ø§ØµÙ„ _TOTAL_ Ø³Ø¬Ù„",
                "zeroRecords": "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª"
            },
            dom:
            "<'row mb-3'<'col-sm-12 text-end'f>>" +        // Ø§Ù„Ø¨Ø­Ø« ÙÙ‚Ø· ÙÙŠ Ø§Ù„ÙŠÙ…ÙŠÙ†
            "<'row'<'col-sm-12'tr>>" +                     // Ø§Ù„Ø¬Ø¯ÙˆÙ„
            "<'row mt-3'<'col-sm-6 text-start'i>>" // Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙŠØ³Ø§Ø± ÙˆØ§Ù„ØªØ±Ù‚ÙŠÙ… ÙŠÙ…ÙŠÙ†
        });
    });
</script>

    <script>
        $('#saveAllBtn').click(function () {
            var form = $('<form method="post" action="/Grades/SaveAll"></form>');

            // Ø¥Ø¶Ø§ÙØ© TeacherId Ùˆ SubjectId
            form.append('<input type="hidden" name="teacherId" value="@ViewBag.TeacherId" />');
            form.append('<input type="hidden" name="subjectId" value="@ViewBag.SubjectId" />');

            // Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
            $('table input').each(function () {
                var input = $(this).clone();
                form.append(input);
            });

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            $('body').append(form);
            form.submit();
        });
    </script>


    <style>
        .small-input {
            max-width: 80px;
            padding: 4px;
        }
        #gradesTable td, #gradesTable th {
            font-size: large;
        }
        
    </style>

}
