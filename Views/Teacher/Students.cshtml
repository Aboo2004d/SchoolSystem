@{
    ViewData["Title"] = "Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨";
}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />

<h2>Ø§Ù„Ø·Ù„Ø§Ø¨</h2>

<button id="exportBtn" class="btn btn-outline-success"><i class="bi bi-file-earmark-arrow-up"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø§Ø¨</button>

<a class="btn btn-outline-dark" asp-controller="Teacher" asp-action="Index">
    <i class="bi bi-arrow-left-circle"></i> Ø¹ÙˆØ¯Ø©</a>
<hr>
<table id="studentsTable" class="display" style="width:100%">
    <thead>
        <tr>
            <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
            <th>Ø§Ù„ØµÙ</th>
            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
        </tr>
    </thead>
</table>
<form asp-action="Delete" id="DeleteStudent" >
    <input type="hidden" name="Id" id="studentid" />
</form>
@section Scripts {
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script>
        $(document).ready(function () {
            var idTeacher = @Html.Raw(ViewBag.IdTeacher);
            $('#studentsTable').DataTable({
                "deferRender": true,
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": "/Teacher/ManagerStudentToTeacher?teacherId="+idTeacher,
                    "type": "GET",
                    "dataSrc": function (json) {
                        if (json.error) {
                            if(!json.status){
                                alert(json.error);
                                window.location.href = "/Account/Login";
                            }
                            alert(json.error);
                            window.location.href = "/Teacher/Index";
                            return [];
                        }
                        return json.data;
                    }
                },
                "columns": [
                    { "data": "studentName",
                        "render": function (data) {
                            const parts = data.trim().split(" ");
                            if (parts.length === 1) return parts[0]; // Ø§Ø³Ù… ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·
                            return parts[0] + " " + parts[1] + " " + parts[parts.length - 1]; // Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ + Ø§Ù„Ø£Ø®ÙŠØ±
                        } },
                    { "data": "classroomName"},
                    { "data": "lectuerName"},
                ],
                "language": {
                    "search": "ğŸ”Ø¨Ø­Ø«: ",
                    "lengthMenu": "Ø¹Ø±Ø¶ _MENU_ Ø³Ø¬Ù„",
                    "info": "Ø¹Ø±Ø¶ Ù…Ù†  _START_ Ø§Ù„Ù‰ _END_ Ù…Ù† Ø§ØµÙ„ _TOTAL_ Ø³Ø¬Ù„",
                    "paginate": {
                        "next": "Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©",
                        "previous": "Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©"
                    },
                    "zeroRecords": "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª"
                }
            });
        });
    </script>
    
    <script>
        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù„Ù… Ù…Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø·
        var idTeacher = @Html.Raw(ViewBag.IdTeacher);
        document.getElementById('exportBtn').addEventListener('click', function () {
            // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± (Ù…Ù† Ø®Ù„Ø§Ù„ Toastify Ø£Ùˆ Notyf Ø£Ùˆ SweetAlert)
            Toastify({
                text: "Ø¬Ø§Ø±Ù ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„Ù...",
                duration: 3000,
                gravity: "top",
                position: "center",
                backgroundColor: "#28a745"
            }).showToast();

            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ Ù„Ø­Ø¸Ø§Øª
            setTimeout(function () {
                window.location.href = '@Url.Action("ExportAllStudentInTeacherToExcel", "ExportData", new { idTeacher = "__idTeacher__" })'.replace("__idTeacher__", idTeacher);
            }, 1000); // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        });
    </script>
    <script>
        $(function() {
            
            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø²Ø± Ø§Ù„Ø­Ø°Ù
            $(document).on('click', '.delete', function(e) {
                e.preventDefault();

                var btn = $(this);
                var id = btn.data('id');

                Swal.fire({
                    title: "Are you sure?",
                    text: "You won't be able to revert this!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Yes, delete it!"
                }).then((result) => {
                    if (result.isConfirmed) {
                        $('#studentid').val(id);
                        $('#DeleteStudent').submit();

                        Swal.fire({
                            title: "Deleted!",
                            text: "Student has been deleted.",
                            icon: "success"
                        });
                    }
                });
            });

        });
    </script>
}
